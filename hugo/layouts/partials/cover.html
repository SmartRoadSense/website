{{- $root := . -}}

{{- $coverlib := $.Site.GetPage "page" "library/covers" -}}
{{- $covers := $coverlib.Resources.ByType "image" -}}
{{- $resource := (index (shuffle $covers) 0) -}}

{{- if and .Params.cover (not (isset .Params "single-cover-default")) -}}
    {{- with .Resources.GetMatch (printf "%s*" .Params.cover) -}}
        {{- $resource = . -}}
    {{- end -}}
{{- end -}}

{{- if ne $resource nil -}}
    {{- $srcset := "" -}}
    {{- range (slice 580 780 1280 1600 2048) -}}
        {{- if lt . $resource.Width -}}
            {{- $srcset = printf "%s%s" $srcset ($resource.Resize (printf "%dx q50" .)).RelPermalink -}}
            {{- $srcset = printf "%s%s" $srcset (printf " %dw, " .) -}}
        {{- end -}}
    {{- end -}}
    {{- $srcset = printf "%s%s" $srcset $resource.RelPermalink -}}
    {{- $srcset = printf "%s%s" $srcset (printf " %dw" $resource.Width) -}}

    <div class="background">
        <img
            src="{{ ($resource.Resize "580x q50").RelPermalink }}"
            alt=""
            {{ printf "srcset=\"%s\"" $srcset | safeHTMLAttr }}
            />
    </div>
{{- end -}}
